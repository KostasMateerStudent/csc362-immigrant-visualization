<!-- Credits for starter code: https://gist.github.com/wboykinm/dbbe50d1023f90d4e241712395c27fb3  -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Visualizing Foreign Immigrant Admissions</title>
    <meta charset="utf-8" />
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../style.css" />
    <style type="text/css">
      /* Legend Font Style */

      /* Legend Position Style */
      .legend {
        position: relative;
        justify-content: left;
        margin-top: -525px;
        margin-left: 120px;
        bottom: 600px;
      }

      .axis text {
        font: 10px sans-serif;
      }

      .axis line,
      .axis path {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }

      #chart {
        display: flex;
        justify-content: center;
      }
    </style>
  </head>
  <body>
    <div class="jumbotron text-center">
      <h1>Visualizing Foreign Immigrant Admissions</h1>
      <p style="text-align: center">Kostas Mateer and Sathish Karthikeyan</p>
      <a href="../index.html" class="btn btn-default" role="button"
        >Go back to Main Page</a
      >
      <a href="viz2.html" class="btn btn-default" role="button"
        >Go to previous visualization</a
      >
      <a href="viz4.html" class="btn btn-default" role="button"
        >Go to next visualization</a
      >
    </div>
    <div class="container">
      <div class="row">
        <button
          type="button"
          onclick="window.location.href='/views/story.html'"
          class="our-story btn btn-primary btn-lg btn-block"
        >
          Click Here to View Our Story!
        </button>
      </div>
      <div class="row" id="container-chart">
        <div class="row">
          <p class="lead" style="font-size: 4rem">Visualization 3</p>
          <h1 id="title">
            Which US states are nonimmigrants entering the US from?
          </h1>
          <h4>About Dataset Used for Choropleth:</h4>
          <p class="larger-text">
            The dataset used for this choropleth map is from the Department of
            Homeland Security, and it shows the amount of admissions by state of
            temporary workers and their families in the fiscal year 2021.
          </p>
          <h4>Our Question:</h4>
          <p class="larger-text">
            Building on our previous visualizations and data, we were curious to
            find out where these nonimmigrants were entering the US from. We
            hypothesized that coastal regions would be the most common entry
            points, and we wanted to see if that was the case. We also wanted to
            identify the states that receive the most nonimmigrants and examine
            their legislative policies towards immigrants.
          </p>
          <div id="chart"></div>
          <h4>Analysis of Chart:</h4>
          <p class="larger-text">
            Our hypothesis was confirmed as the coastal parts of the US have the
            most admissions, with California, Florida, and the East Coast having
            the highest numbers. We also noticed that Michigan, Washington,
            Arizona, and Texas had high numbers of admissions. While we believe
            that Michigan and Washington's proximity to Canada could be a
            factor, we are curious as to why Arizona and Texas had such high
            numbers, but not New Mexico. We speculate that Mexico and South
            America could be the primary reasons for the high levels of
            admissions in Arizona and Texas. This choropleth map helps identify
            entry points for nonimmigrants, and raises important questions about
            these particular states. Do they offer more opportunities for
            nonimmigrants? Are they more welcoming to nonimmigrants? Or are they
            experiencing increasing pressure due to the number of nonimmigrants
            entering the state? Another possibility is that they may have major
            airports that serve as initial entry points for nonimmigrants, who
            then move to other states.
          </p>
          <h4>Further Discussion:</h4>
          <p class="larger-text">
            This choropleth map is a useful tool for identifying entry points
            for nonimmigrants in the US. The map highlights California, Arizona,
            Michigan, Texas, Florida, New York, and Washington State as the
            states with the highest levels of admissions. While some of these
            states' high admissions are easily explained by proximity to other
            countries, others, such as Michigan and Washington, are more
            perplexing. Although New Mexico is also close to Mexico, it has a
            significantly lower population than Arizona and Texas, which could
            be a contributing factor. This choropleth map raises questions about
            state policies towards immigrants and offers insights into how
            different states handle the influx of nonimmigrants.
          </p>
        </div>
        <div class="row">
          <a href="../index.html" class="btn btn-default btn-sm" role="button"
            >Go back to Main Page</a
          >
          <a href="viz2.html" class="btn btn-default btn-sm" role="button"
            >Go to previous visualization</a
          >
          <a href="viz4.html" class="btn btn-default btn-sm" role="button"
            >Go to next visualization</a
          >
        </div>
      </div>
    </div>
    <script type="text/javascript">
      //Width and height of map

      var margin = { top: 40, right: 20, bottom: 60, left: 80 };
      (width = 1000 - margin.left - margin.right),
        (height = 500 - margin.top - margin.bottom);

      var lowColor = "#ffffb2";
      var highColor = "#b10026";

      // D3 Projection
      var projection = d3
        .geoAlbersUsa()
        .translate([width / 2, height / 2]) // translate to center of screen
        .scale([1000]); // scale things down so see entire US

      // Define path generator
      var path = d3
        .geoPath() // path generator that will convert GeoJSON to SVG paths
        .projection(projection); // tell path generator to use albersUsa projection

      var margin = { top: 100, right: 50, bottom: 60, left: 80 },
        width = 1000 - margin.left - margin.right,
        height = 600 - margin.top - margin.bottom;

      const tooltip = d3
        .select("body")
        .append("div")
        .attr("class", "d3-tooltip")
        .style("position", "absolute")
        .style("z-index", "10")
        .style("visibility", "hidden")
        .style("padding", "15px")
        .style("background", "rgba(0,0,0,0.6)")
        .style("border-radius", "5px")
        .style("color", "#fff")
        .text("a simple tooltip");
      //Create SVG element and append map to the SVG
      var svg = d3
        .select("#chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      // Load in my states data!
      d3.csv("../data/statesdata.csv", function (data) {
        var dataArray = [];
        for (var d = 0; d < data.length; d++) {
          dataArray.push(parseFloat(data[d].value));
        }
        var minVal = d3.min(dataArray);
        var maxVal = d3.max(dataArray);
        var ramp = d3
          .scaleLinear()
          .domain([minVal, maxVal])
          .range([lowColor, highColor]);

        // Load GeoJSON data and merge with states data
        d3.json("../json/us-states.json", function (json) {
          // Loop through each state data value in the .csv file
          for (var i = 0; i < data.length; i++) {
            // Grab State Name
            var dataState = data[i].state;

            // Grab data value
            var dataValue = data[i].value;

            // Find the corresponding state inside the GeoJSON
            for (var j = 0; j < json.features.length; j++) {
              var jsonState = json.features[j].properties.name;

              if (dataState == jsonState) {
                // Copy the data value into the JSON
                json.features[j].properties.value = dataValue;

                // Stop looking through the JSON
                break;
              }
            }
          }

          // Bind the data to the SVG and create one path per GeoJSON feature
          svg
            .selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("stroke", "#fff")
            .style("stroke-width", "1")
            .style("fill", function (d) {
              return ramp(d.properties.value);
            })
            .on("mouseover", function (d, i) {
              tooltip
                .html(
                  `${d.properties.name}: ${Number(
                    d.properties.value
                  ).toLocaleString()}`
                )
                .style("visibility", "visible");
              svg.selectAll("path").attr("opacity", 0.4);
              d3.select(this).attr("opacity", 1);
            })
            .on("mousemove", function () {
              tooltip
                .style("top", event.pageY - 60 + "px")
                .style("left", event.pageX - 100 + "px");
            })
            .on("mouseout", function () {
              svg.selectAll("path").attr("opacity", 1);
              tooltip.html(``).style("visibility", "hidden");
            });

          // add a legend
          var w = 140,
            h = 300;

          var key = d3
            .select("#container-chart")
            .append("svg")
            .attr("width", w)
            .attr("height", h)
            .attr("class", "legend");

          var legend = key
            .append("defs")
            .append("svg:linearGradient")
            .attr("id", "gradient")
            .attr("x1", "100%")
            .attr("y1", "0%")
            .attr("x2", "100%")
            .attr("y2", "100%")
            .attr("spreadMethod", "pad");

          legend
            .append("stop")
            .attr("offset", "0%")
            .attr("stop-color", highColor)
            .attr("stop-opacity", 1);

          legend
            .append("stop")
            .attr("offset", "100%")
            .attr("stop-color", lowColor)
            .attr("stop-opacity", 1);

          key
            .append("rect")
            .attr("width", w - 100)
            .attr("height", h)
            .style("fill", "url(#gradient)")
            .attr("transform", "translate(0,10)");

          var y = d3.scaleLinear().range([h, 0]).domain([minVal, maxVal]);

          var yAxis = d3.axisRight(y);

          key
            .append("g")
            .attr("class", "y axis")
            .attr("transform", "translate(41,10)")
            .call(yAxis);
        });
      });

      svg
        .append("text")
        .attr("x", width / 2)
        .attr("y", 0 - margin.top / 2)
        .attr("text-anchor", "middle")
        .style("font-size", "20px")
        .style("text-decoration", "underline")
        .text("# of Nonimmigrant Worker Admissions to the US by State in 2021");
    </script>
  </body>
</html>
