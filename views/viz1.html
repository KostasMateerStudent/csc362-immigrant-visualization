<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Visualizing Foreign Immigrant Admissions</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <div class="jumbotron text-center">
      <h1>Visualizing Foreign Immigrant Admissions</h1>
      <p style="text-align: center">Kostas Mateer and Sathish Karthikeyan</p>
      <a href="../index.html" class="btn btn-default" role="button"
        >Go back to Main Page</a
      >
      <a href="viz2.html" class="btn btn-default" role="button"
        >Go to next visualization</a
      >
    </div>

    <div class="container">
      <div class="row">
        <button
          type="button"
          onclick="window.location.href='/views/story.html'"
          class="our-story btn btn-primary btn-lg btn-block"
        >
          Click Here to View Our Story!
        </button>
      </div>
      <div class="row">
        <p class="lead" style="font-size: 4rem">Visualization 1</p>
        <h1 id="title"></h1>
        <div class="larger-text" id="aboutDataset"></div>
        <div class="larger-text" id="aboutQuestion"></div>
        <div class="larger-text" id="chart"></div>
        <div class="larger-text" id="aboutChart"></div>
        <div class="larger-text" id="furtherDiscussion"></div>
      </div>
      <div class="row">
        <a href="../index.html" class="btn btn-default btn-sm" role="button"
          >Go back to Main Page</a
        >
        <a href="viz2.html" class="btn btn-default btn-sm" role="button"
          >Go to next visualization</a
        >
      </div>
    </div>

    <style>
      .header-text {
        margin-bottom: 0;
      }

      .sub-text {
        margin-top: 0.5em;
      }

      .axis--x path {
        stroke: black;
      }

      .line {
        fill: none;
        stroke: steelblue;
        stroke-width: 3px;
      }

      #chart {
        display: flex;
        justify-content: center;
      }
    </style>

    <script>
      // header code
      const title = d3.select("#title");
      title
        .classed("text", true)
        .text(
          "Exploring Disparties of Foreign National Admissions into the US Over Time"
        );

      // about dataset
      const aboutData = d3.select("#aboutDataset");
      aboutData
        .append("h4")
        .text("About Dataset Used for Time Series:")
        .classed("header-text", true);
      aboutData
        .append("p")
        .text(
          "Dataset is from Department of Homeland Security. It has total nonimmigrant admissions" +
            " into the United States from fiscal years 2012 to 2021. The regions of citizenship are" +
            " Africa, Asia, Europe, North America, Oceania and South America."
        )
        .classed("sub-text", true);

      // about question
      const aboutQuestion = d3.select("#aboutQuestion");
      aboutQuestion
        .append("h4")
        .text("Our Question:")
        .classed("header-text", true);
      aboutQuestion
        .append("p")
        .text(
          "What are the disparities in the admission of nonimmigrants into the US? We are exploring this question to investigate if there are systemic biases or racial prejudices present in the US immigration system. Our goal is to visualize any trends over time and understand if there are any patterns of favoritism towards certain countries or regions. Additionally, we want to examine the impact of the COVID-19 pandemic on these disparities and see if it exacerbated any existing inequalities."
        )
        .classed("sub-text", true)
        .style("margin-bottom", "0.5em");

      aboutQuestion
        .append("p")
        .text(
          "We are interested in exploring disparities in the admission of nonimmigrants into the US over time, as we suspect that there may be systemic racial biases in the immigration system. We also want to investigate the impact of COVID on these disparities. We chose to focus on different regions of the world because it allows us to visualize how people from various parts of the world are treated and whether certain groups are favored over others. Additionally, the selection of regions is important because it provides a generalization of the world, and we can explore how groups of people from different parts of the world are affected by discriminatory practices. It is also worth noting that Africa has a higher population than Europe, which makes it important to explore whether African immigrants are being treated fairly in comparison to other regions."
        )
        .style("margin-top", 0);

      // Define dimensions for the chart
      var margin = { top: 40, right: 150, bottom: 60, left: 80 },
        width = 1000 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

      // Define the SVG element
      // append the svg object to the body of the page
      // append a 'group' element to 'svg'
      // moves the 'group' element to the top left margin
      var svg = d3
        .select("#chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      // timeParse function to convert text into Date object
      var parseTime = d3.timeParse("%Y");

      // Define the x, y and have color scheme scales
      var x = d3.scaleTime().range([0, width]),
        y = d3.scaleLinear().range([height, 0]),
        z = d3.scaleOrdinal(d3.schemeCategory10);

      // define how the line function will be setup
      var line = d3
        .line()
        .curve(d3.curveLinear)
        .x((d) => x(d.Year))
        .y((d) => y(d.Number));

      //read data
      d3.csv("/data/Continents.csv").then((data) => {
        data.forEach((d) => {
          d.Year = parseTime(d.Year);
          d.Number = +d.Number;
        });

        var continents = d3
          .nest()
          .key((d) => d.Continent)
          .entries(data);

        // Set the domain for the x and y scales
        x.domain(d3.extent(data, (d) => d.Year));
        y.domain([
          0,
          d3.max(continents, (c) => d3.max(c.values, (d) => d.Number)),
        ]);
        z.domain(continents.map((c) => c.key));

        // Add the x axis
        svg
          .append("g")
          .attr("class", "axis axis--x")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));

        // Add the y axis
        svg
          .append("g")
          .attr("class", "axis axis--y")
          .call(d3.axisLeft(y))
          .append("text")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", "0.71em")
          .attr("fill", "#000")
          .style("font-size", "11px")
          .text("Number of Nonimmigrant Admissions");

        // prototype for continents
        var continent = svg
          .selectAll(".continent")
          .data(continents)
          .enter()
          .append("g")
          .attr("class", "continent");

        // create lines for each continent
        continent
          .append("path")
          .attr("class", "line")
          .attr("d", (d) => line(d.values))
          .style("stroke", (d) => z(d.key))
          .style("opacity", 1);

        // setup the legend
        var legendBox = 140;
        var legend = svg
          .selectAll(".legend")
          .data(continents)
          .enter()
          .append("g")
          .attr("class", "legend")
          .attr("transform", function (d, i) {
            return "translate(0, " + i * 20 + ")";
          });

        // Define a variable to keep track of which continent is clicked
        var clickedContinent = null;
        // Define the click event for the legend
        legend.on("click", function (d) {
          // Check if the clicked continent is the same as the one previously clicked
          var sameContinentClicked = clickedContinent === d.key;

          // Set the opacity for the clicked and unclicked continents
          var clickedOpacity = sameContinentClicked ? 1 : 0.2;
          var unclickedOpacity = sameContinentClicked ? 1 : 0.2;

          // Update the clicked continent variable
          clickedContinent = sameContinentClicked ? null : d.key;

          // Update the opacity of the lines based on which continent is clicked
          d3.selectAll(".line").style("opacity", function (e) {
            return e.key === clickedContinent || clickedContinent === null
              ? 1
              : unclickedOpacity;
          });
        });

        // add color scheme and rectangles to legend
        legend
          .append("rect")
          .attr("x", width + 10)
          .attr("y", margin.top)
          .attr("rx", 5)
          .attr("width", legendBox)
          .attr("height", 20)
          .style("fill", (d) => z(d.key))
          .classed("selected", true);

        // add text to legend
        legend
          .style("cursor", "pointer")
          .append("text")
          .attr("x", width + 10 + legendBox / 2)
          .attr("y", margin.top + 9)
          .attr("dy", ".35em")
          .attr("text-anchor", "middle")
          .text((d) => d.key);

        //x-axis label
        svg
          .append("text")
          .attr(
            "transform",
            "translate(" +
              width / 2 +
              " ," +
              (height + margin.bottom - 10) +
              ")"
          )
          .style("text-anchor", "middle")
          .text("Year");

        //Title
        svg
          .append("text")
          .attr("x", width / 2)
          .attr("y", 0 - margin.top / 2)
          .attr("text-anchor", "middle")
          .style("font-size", "20px")
          .style("text-decoration", "underline")
          .text(
            "# of Nonimmigrant admissions to the US between fiscal years 2012-2021"
          );
      });

      // about chart
      const aboutChart = d3.select("#aboutChart");
      aboutChart
        .append("h4")
        .text("Analysis of Chart:")
        .classed("header-text", true);
      aboutChart
        .append("p")
        .text(
          "The graph provides insights into our question, but further analysis is required. There is a significant disparity between Europe, Asia, and the rest of the world. Although the high number of nonimmigrant admissions from Asia could suggest a lack of prejudice, Europe has the highest number of admissions (excluding North America). This trend may be attributed to differences in wealth between the continents, as individuals with higher-paying jobs may have better opportunities to enter the US for work purposes. Another interesting observation is the impact of COVID-19 on immigration patterns. All continents experienced a significant decrease in the number of immigrants coming to the US, but South America continued to send relatively higher numbers of immigrants compared to other regions. This could be explained by the proximity of South America to the US."
        )
        .classed("sub-text", true);

      // further discussion
      const furtherDiscussion = d3.select("#furtherDiscussion");
      furtherDiscussion
        .append("h4")
        .text("Further Discussion:")
        .classed("header-text", true);
      furtherDiscussion
        .append("p")
        .text(
          "The time-series graph provided us with valuable insights to better understand our research question on whether the US shows preferences in admitting certain groups over others. However, there are still several unanswered questions. While it's clear that Europe, Asia, South America, and North America have the highest number of admissions into the US, we need to investigate the reasons behind this trend. Is it due to geographical proximity, cultural ties, financial stability, or some other factor? Another crucial aspect to consider is whether the US immigration policies are biased towards certain regions or ethnic groups. To address these questions, we need to conduct more in-depth analysis. For instance, we can calculate per capita admission rates, which would account for population differences across continents. Normalizing for other factors like income levels and education can help us better understand the underlying causes of the disparities observed. Additionally, examining country-level data can shed light on whether a particular country dominates a continent in terms of admissions or whether the trend is more evenly distributed. It's important to note that the dataset only includes the number of admissions, and someone from Mexico or Canada could potentially enter the US multiple times in a year. This might create a slight bias and make North America appear to have more admissions than other regions. Therefore, we need to be mindful of these limitations while interpreting the data."
        )
        .classed("sub-text", true);
    </script>
  </body>
</html>
